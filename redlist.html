<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IMBR ‚Äì Redlist</title>

  <link rel="stylesheet" href="style.css" />

  <style>
    main { max-width: 1180px; margin: 0 auto; padding: 22px 16px 36px; }

    .page-title{
      font-size: 1.4rem;
      font-weight: 900;
      letter-spacing: 0.02em;
      margin: 6px 0 14px;
    }

    .card{
      background: rgba(11,16,32,0.96);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 18px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.45);
      padding: 16px;
      margin: 14px 0;
      overflow: hidden;
    }

    .card-header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 14px;
      margin-bottom: 12px;
    }

    .card-title{
      font-size: 1.12rem;
      font-weight: 900;
      margin: 0;
      letter-spacing: 0.02em;
    }

    .card-sub{
      margin: 4px 0 0;
      color: rgba(245,245,245,0.68);
      font-size: 0.92rem;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 800;
      font-size: 0.78rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: rgba(245,245,245,0.85);
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.22);
      white-space: nowrap;
      flex: 0 0 auto;
    }
    .pill .dot{
      width: 8px; height: 8px; border-radius: 99px;
      background: rgba(0,179,107,0.85);
      box-shadow: 0 0 10px rgba(0,179,107,0.35);
    }
    .pill.red .dot{
      background: rgba(255,59,59,0.95);
      box-shadow: 0 0 10px rgba(255,59,59,0.45);
    }
    .pill.yellow .dot{
      background: rgba(245,197,66,0.95);
      box-shadow: 0 0 10px rgba(245,197,66,0.40);
    }

    .table-wrap{
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px;
      overflow: hidden;
    }

    table{
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
    }

    thead th{
      text-align:left;
      padding: 12px 12px;
      background: linear-gradient(90deg, rgba(0,179,107,0.22), rgba(28,126,214,0.18));
      color: rgba(245,245,245,0.92);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      font-size: 0.78rem;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    tbody td{
      padding: 12px 12px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      color: rgba(245,245,245,0.9);
    }

    tbody tr:hover{
      background: rgba(255,255,255,0.03);
    }

    .aoe-link{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 8px 12px;
      border-radius: 12px;
      text-decoration:none;
      background: rgba(245,197,66,0.14);
      border: 1px solid rgba(245,197,66,0.55);
      color: #ffe083;
      font-weight: 800;
      font-size: 0.9rem;
      white-space: nowrap;
      transition: transform .15s ease, background .15s ease;
    }
    .aoe-link:hover{
      transform: translateY(-1px);
      background: rgba(245,197,66,0.22);
    }

    /* Destaque para o card CR√çTICO (interse√ß√£o) */
    .danger-name, .danger-name *{
      color: #ff3b3b !important;
      text-shadow: 0 0 6px rgba(255,59,59,0.6);
      font-weight: 900;
    }

    /* cores para partidas (0 = vermelho, 1..29 = gradiente, >=30 = verde) */
    .partidas-vermelho { color: #ff3b3b; font-weight: 900; }
    .partidas-verde { color: #00b36b; font-weight: 900; }
    .muted { color: rgba(245,245,245,0.62); }

    @media (max-width: 860px){
      .card-header{ flex-direction:column; align-items:flex-start; }
      .pill{ align-self:flex-start; }
      thead{ display:none; }
      table, tbody, tr, td{ display:block; width:100%; }
      tbody td{ border-bottom: none; padding: 10px 12px; }
      tbody tr{ border-bottom: 1px solid rgba(255,255,255,0.06); padding: 8px 0; }
      tbody td::before{
        content: attr(data-label);
        display:block;
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: rgba(245,245,245,0.55);
        margin-bottom: 6px;
      }
    }
  </style>
</head>

<body>
<div id="menu-container"></div>
<header>
  <div class="header-inner">
    <a href="index.html" class="logo-link">
      <div class="logo-box">
        <img src="imbr-logo.png" alt="Logo Clan IMBR" />
        <div>
            <div class="logo-text-main">IMBR</div>
            <div class="logo-text-sub">Clan 100% Brasileiro ¬∑ Age of Empires IV</div>
          </div>
      </div>
    </a>

    <button class="menu-toggle" type="button" aria-label="Abrir menu" data-menu-open>
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
</header>

  <main>
    <div class="page-title">Redlist</div>

    <!-- 1) CR√çTICOS -->
    <section class="card" id="card-criticos">
      <div class="card-header">
        <div>
          <h2 class="card-title">‚ö†Ô∏è Cr√≠ticos</h2>
          <p class="card-sub">Jogadores que est√£o <strong>Recruta &lt; 30 jogos</strong> e <strong>sem tag IMBR</strong> ao mesmo tempo.</p>
        </div>
        <div class="pill red"><span class="dot"></span> Prioridade</div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Jogador</th>
              <th>Partidas (30d)</th>
              <th>Dias no clan</th>
              <th>Perfil</th>
            </tr>
          </thead>
          <tbody id="criticos-body">
            <tr><td class="muted" colspan="4">Carregando‚Ä¶</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- 2) Recrutas < 30 (restantes) -->
    <section class="card" id="card-recrutas30">
      <div class="card-header">
        <div>
          <h2 class="card-title">Recrutas com menos de 30 jogos (restantes)</h2>
          <p class="card-sub">Somente quem √© <strong>Recruta</strong> e tem <strong>&lt; 30 partidas</strong>, mas <strong>j√° tem IMBR</strong> no nome.</p>
        </div>
        <div class="pill yellow"><span class="dot"></span> Acompanhar</div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Jogador</th>
              <th>Partidas (30d)</th>
              <th>Dias no clan</th>
              <th>Perfil</th>
            </tr>
          </thead>
          <tbody id="recrutas30-body">
            <tr><td class="muted" colspan="4">Carregando‚Ä¶</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- 3) Sem IMBR (restantes) -->
    <section class="card" id="card-semimbr">
      <div class="card-header">
        <div>
          <h2 class="card-title">Jogadores sem tag IMBR (restantes)</h2>
          <p class="card-sub">Somente quem est√° <strong>sem IMBR</strong> no nome, mas <strong>n√£o entra no crit√©rio de Recruta &lt; 30</strong>.</p>
        </div>
      </div>

      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Fun√ß√£o</th>
              <th>Jogador</th>
            </tr>
          </thead>
          <tbody id="semimbr-body">
            <tr><td class="muted" colspan="2">Carregando‚Ä¶</td></tr>
          </tbody>
        </table>
      </div>
    </section>

  </main>

  <footer>
    <span>Desenvolvido por AzX(Gui) IMBR ¬∑ Age of Empires IV ¬∑ Brasil</span>
  </footer>

<script src="menu.js"></script>
  
  <script>
 
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTihzZmyAJhTVjALmuX1R1YTGyuW0p-5umWppci2rQVRMJ5h1m2IrkZo4wi4MUN_fZ03vxu2vwFT2ob/pub?gid=1146212629&single=true&output=csv";

    // CSV robusto
    function parseCSV(text) {
      const rows = [];
      let row = [];
      let cur = "";
      let inQuotes = false;

      for (let i = 0; i < text.length; i++) {
        const ch = text[i];
        const next = text[i + 1];

        if (ch === '"' && inQuotes && next === '"') { cur += '"'; i++; continue; }
        if (ch === '"') { inQuotes = !inQuotes; continue; }

        if (ch === "," && !inQuotes) { row.push(cur); cur = ""; continue; }

        if ((ch === "\n" || ch === "\r") && !inQuotes) {
          if (ch === "\r" && next === "\n") i++;
          row.push(cur); cur = "";
          if (row.length > 1 || row[0]?.trim()) rows.push(row);
          row = [];
          continue;
        }

        cur += ch;
      }

      if (cur.length || row.length) {
        row.push(cur);
        if (row.length > 1 || row[0]?.trim()) rows.push(row);
      }
      return rows;
    }

    function safeText(v) { return (v ?? "").toString().trim(); }
    function toKey(nome) { return safeText(nome).toLowerCase(); }

    function hasIMBR(nome) {
      return safeText(nome).toUpperCase().startsWith("IMBR");
    }

    function aplicarCorPartidas(elemento, valor) {
      if (!elemento) return;
      if (valor == null) return;

      const numero = parseInt(valor.toString().replace("+", ""), 10);
      if (isNaN(numero)) return;

      elemento.classList.remove("partidas-vermelho", "partidas-verde");
      elemento.style.color = "";
      elemento.style.fontWeight = "900";

      if (numero === 0) {
        elemento.classList.add("partidas-vermelho");
      } else if (numero < 30) {
        const t = (numero - 1) / 28; // 1..29 -> 0..1
        const hue = 0 + 50 * t;      // vermelho->amarelo
        elemento.style.color = `hsl(${hue}, 100%, 50%)`;
      } else {
        elemento.classList.add("partidas-verde");
      }
    }

    function renderRow4(tbody, p, nameClass) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td data-label="Jogador" class="${nameClass || ""}">${p.nome}</td>
        <td data-label="Partidas (30d)" class="matches-cell">${p.matchs || "‚Äî"}</td>
        <td data-label="Dias no clan">${p.dias || "‚Äî"}</td>
        <td data-label="Perfil">
          <a class="aoe-link" href="${p.perfil || "#"}" target="_blank" rel="noopener">Ver perfil</a>
        </td>
      `;
      tbody.appendChild(tr);
      aplicarCorPartidas(tr.querySelector(".matches-cell"), p.matchs);
    }

    function renderRow2(tbody, p) {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td data-label="Fun√ß√£o">${p.role || "‚Äî"}</td>
        <td data-label="Jogador">${p.nome}</td>
      `;
      tbody.appendChild(tr);
    }

    async function init() {
      const criticosBody = document.getElementById("criticos-body");
      const recrutasBody = document.getElementById("recrutas30-body");
      const semimbrBody  = document.getElementById("semimbr-body");

      try {
        const r = await fetch(CSV_URL, { cache: "no-store" });
        const csvText = await r.text();

        const table = parseCSV(csvText);
        const dataRows = table.slice(1);

        const players = dataRows
          .map(cols => ({
            nome:   safeText(cols[0]),
            role:   safeText(cols[1]),
            matchs: safeText(cols[4]),
            dias:   safeText(cols[5]),
            perfil: safeText(cols[6]),
          }))
          .filter(p => !!p.nome);

        // Helpers de crit√©rio
        function isRecrutaUnder30(p) {
          const partidas = parseInt((p.matchs || "").toString().replace("+", ""), 10);
          return p.role === "Recruta" && !isNaN(partidas) && partidas < 30;
        }
        function isSemIMBR(p) {
          return !hasIMBR(p.nome);
        }

        // 3 listas
        const criticos = [];
        const recrutasRestantes = [];
        const semImbrRestantes = [];

        for (const p of players) {
          const A = isRecrutaUnder30(p);
          const B = isSemIMBR(p);

          if (A && B) criticos.push(p);
          else if (A && !B) recrutasRestantes.push(p);
          else if (!A && B) semImbrRestantes.push(p);
        }

        // Ordena√ß√µes
        const byMatchAsc = (a,b) => {
          const pa = parseInt((a.matchs||"0").replace("+",""),10) || 0;
          const pb = parseInt((b.matchs||"0").replace("+",""),10) || 0;
          return pa - pb;
        };

        criticos.sort(byMatchAsc);
        recrutasRestantes.sort(byMatchAsc);
        semImbrRestantes.sort((a,b) => (a.role||"").localeCompare(b.role||"") || a.nome.localeCompare(b.nome));

        // Render
        criticosBody.innerHTML = "";
        recrutasBody.innerHTML = "";
        semimbrBody.innerHTML = "";

        if (criticos.length === 0) {
          criticosBody.innerHTML = `<tr><td class="muted" colspan="4">Nenhum cr√≠tico no momento üëå</td></tr>`;
        } else {
          for (const p of criticos) renderRow4(criticosBody, p, "danger-name");
        }

        if (recrutasRestantes.length === 0) {
          recrutasBody.innerHTML = `<tr><td class="muted" colspan="4">Nenhum recruta restante com &lt; 30 jogos.</td></tr>`;
        } else {
          for (const p of recrutasRestantes) renderRow4(recrutasBody, p, "");
        }

        if (semImbrRestantes.length === 0) {
          semimbrBody.innerHTML = `<tr><td class="muted" colspan="2">Todo mundo j√° est√° com tag IMBR üëå</td></tr>`;
        } else {
          for (const p of semImbrRestantes) renderRow2(semimbrBody, p);
        }

      } catch (err) {
        console.error(err);
        criticosBody.innerHTML = `<tr><td class="muted" colspan="4">Erro ao carregar a planilha.</td></tr>`;
        recrutasBody.innerHTML = `<tr><td class="muted" colspan="4">Erro ao carregar a planilha.</td></tr>`;
        semimbrBody.innerHTML  = `<tr><td class="muted" colspan="2">Erro ao carregar a planilha.</td></tr>`;
      }
    }

    init();
  </script>
</body>
</html>
